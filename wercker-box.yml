name: golite
version: 0.0.1
inherits: ruudk/ubuntu14.04@1.0.0
description: Wercker box for testing GoLite
type: main
platform: ubuntu@14.04
box-detect:
  priority: 1000
  version :
  detect:
    - files:
      - '*.cabal'
script: |
  # variables
  export GHC_VER=7.8.3
  export CABAL_VER=1.20.0.3

  export PREFIX=$HOME/.local
  export PATH=$HOME/.cabal/bin:$PREFIX/bin:$PATH
  echo 'export PREFIX=$HOME/.local' >> $HOME/.profile
  echo 'export PATH=$HOME/.cabal/bin:$PREFIX/bin:$PATH' >> $HOME/.profile
  GHC_TARBALL=ghc-${GHC_VER}-x86_64-unknown-linux-deb7.tar.xz
  CABAL_TARBALL=cabal-install-${CABAL_VER}.tar.gz
  export TMPDIR=/tmp/install-haskell
  mkdir -p $TMPDIR

  echo -e "\033[1m###  Upgrading system packages...  ###########################################\033[m"
  sudo aptitude update
  sudo aptitude full-upgrade -y

  echo -e "\033[1m###  Installing GHC...  ######################################################\033[m"
  sudo aptitude install -y wget make libgmp-dev
  cd $TMPDIR
  wget https://www.haskell.org/ghc/dist/${GHC_VER}/${GHC_TARBALL}
  tar xf $GHC_TARBALL
  cd ghc-${GHC_VER}
  ./configure --prefix=$PREFIX
  make install
  
  echo -e "\033[1m###  Checking GHC...  ########################################################\033[m"
  ghc --version
  ghc-pkg list

  echo -e "\033[1m###  Installing cabal-install...  ############################################\033[m"
  sudo aptitude install -y curl zlib1g-dev
  cd $TMPDIR
  wget http://hackage.haskell.org/package/cabal-install-${CABAL_VER}/${CABAL_TARBALL}
  tar xf $CABAL_TARBALL
  cd cabal-install-${CABAL_VER}
  ./bootstrap.sh
  
  echo -e "\033[1m###  Checking cabal-install...  ##############################################\033[m"
  cd
  cabal --version
  ghc-pkg list

  echo -e "\033[1m###  Installing node...  #####################################################\033[m"
  curl -sL https://deb.nodesource.com/setup | sudo bash -
  sudo apt-get install -y nodejs
